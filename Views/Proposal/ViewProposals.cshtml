@model List<MyProposalViewModel>
@{
    ViewData["Title"] = "Proposals";
    var isResearcher = (string)ViewBag.Role == "researcher";
    var showingMine = (bool)ViewBag.ShowingMine;
}

<h2>Proposals</h2>

@if (isResearcher)
{
    <form id="toggleForm" method="get" asp-action="ViewProposals">
        <div class="form-check form-switch mb-4">
            <input class="form-check-input" type="checkbox" id="proposalToggle" name="showOnlyMine" value="true" @(showingMine ? "checked" : "")>
            <label class="form-check-label" for="proposalToggle">
                @(showingMine ? "Submitted by You" : "All Proposals")
            </label>
        </div>
    </form>

    <script>
        document.getElementById('proposalToggle').addEventListener('change', function () {
            if (!this.checked) {
                this.value = "false";
                let hiddenInput = document.createElement("input");
                hiddenInput.type = "hidden";
                hiddenInput.name = "showOnlyMine";
                hiddenInput.value = "false";
                this.form.appendChild(hiddenInput);
            }
            this.form.submit();
        });
    </script>
}

@if (Model != null && Model.Any())
{
    <div class="row">
        @foreach (var p in Model)
        {
            <div class="col-md-6 mb-4">
                <a asp-controller="Proposal" asp-action="Details" asp-route-id="@p.Id" style="text-decoration: none; color: inherit;">
                    <div class="card h-100 shadow-sm" style="border: 1px solid #ccc;">
                        <div class="card-header bg-dark text-white">
                            <h5 class="mb-0">Proposal #@p.Id: @p.Title</h5>
                        </div>
                        <div class="card-body">
                            <p><strong>Synopsis:</strong> @p.Synopsis</p>
                            <p><strong>Project Level:</strong> @p.ProjectLevel</p>
                            <p><strong>Estimated Completion Date:</strong> @p.EstimatedCompletionDate.ToString("dd-MM-yyyy")</p>
                            <p><strong>Submitted By:</strong> @p.SubmittedByName</p>

                            @* Status display *@
                            @if (p.StatusName == "New Proposal")
                            {
                                <p><strong>Status:</strong> <span class="fw-bold text-success">New Proposal</span></p>
                            }
                            else
                            {
                                <p><strong>Status:</strong> <span class="">@p.StatusName</span></p>
                            }
                        </div>
                    </div>
                </a>
            </div>
        }
    </div>
}
else
{
    <p>@(isResearcher && showingMine ? "You haven't submitted any proposals yet." : "No proposals available.")</p>
}
